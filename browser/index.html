<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Browser inference demo</title>

  <style>
    #features {
      width: 50%;
      font-size: 18px;
    }

    #results {
      font-family: monospace;
      white-space: pre;
    }
  </style>
</head>

<body>
  <p id="results"></p>
  <p id="test1">max: </p>
  <p id="test2">max label: </p>
  <p id="test3"></p>



  <a id="start_demo" class="btn btn-lg btn-success py-1" href="#" role="button">Zaƒçni meriti</a>

  <!-- <ul>
      <li>X-axis: <span id="Accelerometer_gx">0</span><span> m/s<sup>2</sup></span></li>
      <li>Y-axis: <span id="Accelerometer_gy">0</span><span> m/s<sup>2</sup></span></li>
      <li>Z-axis: <span id="Accelerometer_gz">0</span><span> m/s<sup>2</sup></span></li>
    </ul> -->

  <script src="edge-impulse-standalone.js"></script>
  <script src="run-impulse.js"></script>


  <script>
    var tabelcaSpelca = [];

    function updateFieldIfNotNull(fieldName, value, precision = 10) {
      if (value != null)
        document.getElementById(fieldName).innerHTML = value.toFixed(precision);
    }


    // function getMax(json) {
    //   var max = 0;
    //   var max_label;
    //   for (var i = 0; i < json.results.length; i++) {
    //     if (max == 0 || json.results[i].value > max) {
    //       max = json.results[i].value;
    //       max_label = json.results[i].label;
    //     }
    //   }
    //   return max, max_label;
    // }

    function klasificiraj(tabelcaSpelca) {
      var classifier2 = new EdgeImpulseClassifier();
      classifier2.init();
      let res = classifier2.classify(tabelcaSpelca);

      var max = 0;
      var max_label;
      for (var i = 0; i < json.results.length; i++) {
        if (max == 0 || json.results[i].value > max) {
          max = json.results[i].value;
          max_label = json.results[i].label;
        }
      }
      
      document.getElementById("test1").innerHTML = max;
      document.getElementById("test2").innerHTML = max_label;

      document.querySelector('#results').textContent = JSON.stringify(res, null, 4);

      // okay
    }

    function handleMotion(event) {

      tabelcaSpelca.push(event.accelerationIncludingGravity.x)
      tabelcaSpelca.push(event.accelerationIncludingGravity.y)
      tabelcaSpelca.push(event.accelerationIncludingGravity.z)

      document.getElementById("test3").innerHTML = "dolzina tabelce " + tabelcaSpelca.length;

      if (tabelcaSpelca.length > 540) {
        klasificiraj(tabelcaSpelca)
        tabelcaSpelca = [];
      }


      // updateFieldIfNotNull('Accelerometer_gx', event.accelerationIncludingGravity.x);
      // updateFieldIfNotNull('Accelerometer_gy', event.accelerationIncludingGravity.y);
      // updateFieldIfNotNull('Accelerometer_gz', event.accelerationIncludingGravity.z);

      // updateFieldIfNotNull('Accelerometer_x', event.acceleration.x);
      // updateFieldIfNotNull('Accelerometer_y', event.acceleration.y);
      // updateFieldIfNotNull('Accelerometer_z', event.acceleration.z);

      // updateFieldIfNotNull('Accelerometer_i', event.interval, 2);

    }

    // START OF CYCLE

    let is_running = false;
    let demo_button = document.getElementById("start_demo");
    demo_button.onclick = function (e) {

      e.preventDefault();

      // Request permission for iOS 13+ devices
      if (
        DeviceMotionEvent &&
        typeof DeviceMotionEvent.requestPermission === "function"
      ) {
        DeviceMotionEvent.requestPermission();
      }

      var len = 0;

      if (is_running) {
        window.removeEventListener("devicemotion", handleMotion);
        demo_button.innerHTML = "Start demo";
        demo_button.classList.add('btn-success');
        demo_button.classList.remove('btn-danger');
        is_running = false;
      } else {
        window.addEventListener("devicemotion", handleMotion);
        document.getElementById("start_demo").innerHTML = "koncaj merjenje";
        demo_button.classList.remove('btn-success');
        demo_button.classList.add('btn-danger');
        is_running = true;
      }
    };



  </script>

  <!-- s t a r  s c r i p t  z a  k l a s i f i k a c i j o -->
  <!-- <script>
    (async () => {
      var classifier = new EdgeImpulseClassifier();
      await classifier.init();

      let project = classifier.getProjectInfo();
      document.querySelector('h1').textContent = project.owner + ' / ' + project.name + ' (version ' + project.deploy_version + ')';

      document.querySelector('#run-inference').onclick = () => {
        try {

          // let features = document.querySelector('#features').value.split(',').map(x => Number(x.trim()));
          var features = tabelcaSpelca;
          console.log("features",features)
          let res = classifier.classify(features);
          document.querySelector('#results').textContent = JSON.stringify(res, null, 4);
        }
        catch (ex) {
          alert('Failed to classify: ' + (ex.message || ex.toString()));
        }
      };
    })();
  </script> -->

  <script>
    const obj = {
    anomaly: 0,
    results: [
        {
            label: "desno grdo zavijanje",
            value: 0.0625
        },
        {
            label: "desno lepo zavijanje",
            value: 0.04296875
        },
        {
            label: "levo grdo zavijanje",
            value: 0.03125
        },
        {
            label: "levo lepo zavijanje",
            value: 0.046875
        },
        {
            label: "mocno zaviranje üö®",
            value: 0.01953125
        },
        {
            label: "sibko zaviranje ‚úÖ",
            value: 0.14453125
        },
        {
            label: "voznja",
            value: 0.65234375
        }
    ]
  };

      var maximum = 0;
      var maximum_label;
      for (var i = 0; i < obj.results.length; i++) {
        if (maximum == 0 || obj.results[i].value > max) {
          maximum = obj.results[i].value;
          maximum_label = obj.results[i].label;
        }
      }
      console.log(maximum);
      console.log(maximum_label);
   
  </script>

</body>

</html>